{
  "issue_id": 2067,
  "issue_url": "https://github.com/google/gson/issues/2067",
  "title": "`EnumMap` deserialization fails with `ClassCastException`",
  "description_text": "# Gson version\r\ne2e851c9bc692cec68ba7b0cbb002f82b4a229e4\r\n\r\n# Java / Android version\r\nopenjdk version \"11.0.13\" 2021-10-19\r\nOpenJDK Runtime Environment Temurin-11.0.13+8 (build 11.0.13+8)\r\nOpenJDK 64-Bit Server VM Temurin-11.0.13+8 (build 11.0.13+8, mixed mode)\r\n\r\n# Description\r\n`EnumMap` deserialization fails with `ClassCastException`:\r\n```\r\njava.lang.ClassCastException: class java.util.LinkedHashMap cannot be cast to class java.util.EnumMap\r\n```\r\n\r\nThe underlying issue is related to #1708, it appears special handling for `EnumMap` is missing.\r\n(I am a bit surprised that this issue has not been mentioned here anywhere before.)\r\n\r\n# Reproduction steps\r\nTest case:\r\n```java\r\nprivate static enum MyEnum {\r\n  VALUE1, VALUE2\r\n}\r\n\r\npublic void testEnumMap() throws Exception {\r\n  EnumMap<MyEnum, String> map = new EnumMap<MyEnum, String>(MyEnum.class);\r\n  map.put(MyEnum.VALUE1, \"test\");\r\n  String json = gson.toJson(map);\r\n  assertEquals(\"{\\\"VALUE1\\\":\\\"test\\\"}\", json);\r\n\r\n  Type type = new TypeToken<EnumMap<MyEnum, String>>() {}.getType();\r\n  EnumMap<?, ?> actualMap = gson.fromJson(\"{\\\"VALUE1\\\":\\\"test\\\"}\", type);\r\n  Map<?, ?> expectedMap = Collections.singletonMap(MyEnum.VALUE1, \"test\");\r\n  assertEquals(expectedMap, actualMap);\r\n}\r\n```\r\n\r\n# Exception stack trace\r\nNot really useful because `ClassCastException` occurs in user code.\r\n"
}